@using X.PagedList.Mvc.Core
@model X.PagedList.IPagedList<WorkTrackingSystem.Models.Employee>
@{
    ViewData["Title"] = "Quản lý nhân viên"; // Vietnamese title
    Layout = "~/Areas/AdminSystem/Views/Shared/_Admin.cshtml";

}
<div class="row">
	<div class="col-md-12">
		<ol class="breadcrumb float-sm-end bg-light">
			<li class="breadcrumb-item">Admin</li>
			<li class="breadcrumb-item active" aria-current="page">@ViewData["Title"]</li>
		</ol>
	</div>
</div>
<div class="row">
	<div class="col-md-12" id="list-section">
		@* <h1 class="mb-4 text-center"><i class="bi bi-people"></i> Danh sách nhân viên</h1> *@
		<div class="row mb-2">
			<div class="col-lg-9 col-md-9 col-sm-12">
				<form asp-controller="Employees" asp-action="Index" method="get" class="row">
					<div class="col-md-5">
						<div class="input-group">
							<input type="text" class="form-control" name="search" placeholder="Nhập tên / mã nhân viên" value="@Context.Request.Query["search"]" />
						</div>
					</div>
					<div class="col-md-4">
						<select class="form-select" id="DepartmentId" name="DepartmentId" asp-items="ViewBag.Department">
							<option value="" disabled selected>Chọn phòng ban</option>
						</select>
					</div>
					<div class="col-md-3">
						<button type="submit" class="btn btn-primary">Tìm kiếm & Lọc</button>
					</div>
				</form>
			</div>
		</div>
		<table class="table table-bordered table-hover ">
			<thead class="table-dark text-white text-center">
				<tr>
					<th>Nhân viên</th>
					<th> @Html.DisplayNameFor(model => model.FirstOrDefault().Gender)</th>
					<th class="birthday-column"> @Html.DisplayNameFor(model => model.FirstOrDefault().Birthday)</th>
					@* <th><i class="bi bi-phone"></i> @Html.DisplayNameFor(model => model.FirstOrDefault().Phone)</th> *@
					<th class="email-column"> @Html.DisplayNameFor(model => model.FirstOrDefault().Email)</th>
					<th> @Html.DisplayNameFor(model => model.FirstOrDefault().HireDate)</th>
					<th class="address-column"> @Html.DisplayNameFor(model => model.FirstOrDefault().Address)</th>
					<th> @Html.DisplayNameFor(model => model.FirstOrDefault().Avatar)</th>
					@* <th><i class="bi bi-building"></i> @Html.DisplayNameFor(model => model.FirstOrDefault().Department)</th> *@
					<th class="position-column"> Chức vụ</th>
					<th> Hành động</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var item in Model)
				{
					<tr>
						<td>@Html.DisplayFor(modelItem => item.Code) - @(item.FirstName + " " + item.LastName)</td>
						<td>
							@switch (item.Gender)
							{
								case "Male":
									<span>Nam</span>
									break;
								case "Female":
									<span>Nữ</span>
									break;
								case "Other":
									<span>Khác</span>
									break;
								default:
									<span>Không xác định</span>
									break;
							}
						</td>
						<td class="birthday-column">@Html.DisplayFor(modelItem => item.Birthday)</td>
						@* <td>@Html.DisplayFor(modelItem => item.Phone)</td> *@
						<td class="email-column">@Html.DisplayFor(modelItem => item.Email)</td>
						<td>@Html.DisplayFor(modelItem => item.HireDate)</td>
						<td class="address-column">@Html.DisplayFor(modelItem => item.Address)</td>
						<td class="text-center">
							@if (!string.IsNullOrEmpty(item.Avatar))
							{
								<img src="@item.Avatar" class="img-fluid rounded-circle" style="width: 50px; height: 50px; object-fit: cover;">
							}
						</td>
						@* <td>@Html.DisplayFor(modelItem => item.Department.Name)</td> *@
						<td class="position-column">@Html.DisplayFor(modelItem => item.Position.Name)</td>
						<td>
							<a class="btn btn-primary btn-sm ajax-action" data-url="@Url.Action("Edit", new { id = item.Id })"><i class="bi bi-pencil-square"></i></a>
							<a class="btn btn-info btn-sm ajax-action" data-url="@Url.Action("Details", new { id = item.Id })"><i class="bi bi-info-circle"></i></a>
							<a class="btn btn-danger btn-sm ajax-action" data-url="@Url.Action("Delete", new { id = item.Id })"><i class="bi bi-trash"></i></a>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
	<div class="col-md-4 d-none" id="detail-section">
		<div class="actionCustomers"></div>
	</div>
</div>

@Html.PagedListPager(Model, page => Url.Action("Index", new { page = page }), new PagedListRenderOptions
{
	LiElementClasses = new string[] { "page-item" },
	PageClasses = new string[] { "page-link" },
	DisplayLinkToFirstPage = PagedListDisplayMode.Always, // Luôn hiển thị nút về trang đầu
	DisplayLinkToLastPage = PagedListDisplayMode.Always, // Luôn hiển thị nút đến trang cuối
	DisplayLinkToPreviousPage = PagedListDisplayMode.Always, // Luôn hiển thị nút trước
	DisplayLinkToNextPage = PagedListDisplayMode.Always, // Luôn hiển thị nút sau
	DisplayEllipsesWhenNotShowingAllPageNumbers = true, // Hiển thị dấu ... nếu có quá nhiều trang
	MaximumPageNumbersToDisplay = 5 // Giới hạn số lượng trang hiển thị
})
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function () {
		$(".ajax-action").click(function (e) {
			e.preventDefault();

			var url = $(this).data("url");

			// Kiểm tra nếu phần chi tiết đang ẩn, thì thay đổi layout
			if ($("#detail-section").hasClass("d-none")) {
				$("#list-section").removeClass("col-md-12").addClass("col-md-8");
				$("#detail-section").removeClass("d-none").addClass("col-md-4");
			}
			$(".email-column, .position-column,.address-column,.birthday-column").hide();

			// Load nội dung vào phần chi tiết
			$(".actionCustomers").load(url, function (response, status, xhr) {
				if (status === "error") {
					alert("Lỗi khi tải dữ liệu: " + xhr.status + " " + xhr.statusText);
				}
			});
		});
	});
	function closeDetailSection() {
		$("#list-section").removeClass("col-md-8").addClass("col-md-12"); // Trở về full width
		$("#detail-section").addClass("d-none"); // Ẩn phần chi tiết
		$(".email-column, .position-column,.address-column,.birthday-column").show();
	}
</script>