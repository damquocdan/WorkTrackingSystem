@model WorkTrackingSystem.Models.Job

@{
    ViewData["Title"] = "Tạo mới công việc";
    Layout = "~/Areas/ProjectManager/Views/Shared/_ProjectManager.cshtml";
}

<h1 class="mb-4">Tạo mới công việc</h1>

<div class="row">
    <div class="col-md-6">
        <label class="form-label"><i class="bi bi-list-check"></i> Chọn loại chức năng:</label>
        <select id="taskType" class="form-control">
            <option value="single">1 Nhân viên - 1 Công việc</option>
            <option value="multi">Nhiều Nhân viên - 1 Công việc</option>
            <option value="oneToMany">1 Nhân viên - Nhiều Công việc</option>
        </select>
    </div>
</div>

<br>

<div class="row">
    <div class="col-md-6">
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <!-- Một nhân viên - Một công việc -->
            <div class="mb-3 task-type single">
                <label asp-for="EmployeeId" class="form-label"><i class="bi bi-person"></i> Nhân viên:</label>
                <select asp-for="EmployeeId" class="form-control" asp-items="ViewBag.EmployeeId"></select>
                <span asp-validation-for="EmployeeId" class="text-danger"></span>
            </div>

            <!-- Nhiều nhân viên - Một công việc -->
            <div class="mb-3 task-type multi" style="display: none;">
                <label class="form-label"><i class="bi bi-people"></i> Chọn nhân viên:</label>
                @foreach (var employee in ViewBag.Employees)
                {
                    <div class="form-check">
                        <input type="checkbox" name="SelectedEmployees" value="@employee.Value" class="form-check-input">
                        <label class="form-check-label">@employee.Text</label>
                    </div>
                }
            </div>

            <!-- Một nhân viên - Nhiều công việc -->
            <div class="mb-3 task-type oneToMany" style="display: none;">
                <label class="form-label"><i class="bi bi-person"></i> Chọn Nhân viên:</label>
                <select id="singleEmployee" name="SingleEmployeeId" class="form-control" asp-items="ViewBag.EmployeeId"></select>
            </div>

            <div id="taskContainer">
                <div class="task-group">
                    <div class="mb-3">
                        <label asp-for="CategoryId" class="form-label"><i class="bi bi-tag"></i> Danh mục:</label>
                        <select asp-for="CategoryId" class="form-control" asp-items="ViewBag.CategoryId"></select>
                        <span asp-validation-for="CategoryId" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Name" class="form-label"><i class="bi bi-card-heading"></i> Tên công việc:</label>
                        <input asp-for="Name" class="form-control" />
                        <span asp-validation-for="Name" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Description" class="form-label"><i class="bi bi-file-text"></i> Mô tả:</label>
                        <input asp-for="Description" class="form-control" />
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <div class="mb-3">
                        <label asp-for="Deadline1" class="form-label"><i class="bi bi-calendar-event"></i> Hạn báo cáo lần 1:</label>
                        <input asp-for="Deadline1" type="date" class="form-control" />
                        <span asp-validation-for="Deadline1" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Deadline2" class="form-label"><i class="bi bi-calendar-event"></i> Hạn báo cáo lần 2:</label>
                        <input asp-for="Deadline2" type="date" class="form-control" />
                        <span asp-validation-for="Deadline2" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Deadline3" class="form-label"><i class="bi bi-calendar-event"></i> Hạn báo cáo lần 3:</label>
                        <input asp-for="Deadline3" type="date" class="form-control" />
                        <span asp-validation-for="Deadline3" class="text-danger"></span>
                    </div>

                    <div class="mb-3">
                        <label asp-for="CompletionDate" class="form-label"><i class="bi bi-calendar-check"></i> Hạn hoàn thành:</label>
                        <input asp-for="CompletionDate" type="date" class="form-control" />
                        <span asp-validation-for="CompletionDate" class="text-danger"></span>
                    </div>
                </div>
            </div>

            <div class="mb-3 oneToMany" style="display: none;">
                <button type="button" class="btn btn-success" id="addTask"><i class="bi bi-plus-circle"></i> Thêm công việc</button>
            </div>

            <div class="mb-3">
                <button type="submit" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Tạo mới</button>
                <a asp-action="Index" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Quay lại danh sách</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.getElementById("taskType").addEventListener("change", function () {
            let selected = this.value;
            document.querySelectorAll(".task-type").forEach(e => e.style.display = "none");
            document.querySelectorAll(`.${selected}`).forEach(e => e.style.display = "block");
        });

        document.getElementById("addTask").addEventListener("click", function () {
            let newTask = document.querySelector(".task-group").cloneNode(true);
            document.getElementById("taskContainer").appendChild(newTask);
        });
    </script>
}
